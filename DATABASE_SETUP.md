# Database Setup Guide (Updated for Vercel Marketplace)

Vercel has transitioned from offering direct Postgres to using marketplace providers. This guide will help you set up a Postgres database using Neon (recommended) or another provider.

## Option 1: Neon (Recommended - Free Tier Available)

Neon is the recommended Postgres provider for Vercel projects and offers a generous free tier.

### Steps:

1. **Go to Vercel Marketplace**
   - Navigate to your Vercel project dashboard
   - Go to **Storage** tab
   - Click **Create Database** or **Browse Marketplace**
   - Look for **Neon** in the marketplace

2. **Install Neon Integration**
   - Click on **Neon**
   - Click **Install** or **Add Integration**
   - Select your Vercel project (LearnGerman)
   - Follow the setup wizard

3. **Create Database**
   - Neon will prompt you to create a new database or use an existing one
   - Choose a name (e.g., "learngerman-db")
   - Select a region closest to your users
   - Choose the free tier (if available)

4. **Environment Variables**
   - Neon will automatically add environment variables to your Vercel project
   - The main variable will be `DATABASE_URL` or `POSTGRES_URL`
   - Check your Vercel project's Environment Variables section

5. **Update Code (if needed)**
   - If Neon provides `DATABASE_URL` instead of `POSTGRES_URL`, you may need to update the code
   - See "Code Updates" section below

## Option 2: Other Marketplace Providers

You can also use other Postgres providers from the Vercel Marketplace:
- **Supabase** (also has free tier)
- **PlanetScale** (MySQL, not Postgres)
- **Railway** (Postgres available)

## Code Updates Required

Since we're using `@vercel/postgres`, we need to ensure the connection string format is correct. 

### If Neon provides `DATABASE_URL`:

You have two options:

**Option A: Use Neon's connection string directly with `@vercel/postgres`**
- Neon's connection string should work with `@vercel/postgres`
- The package will automatically use `POSTGRES_URL` or `DATABASE_URL`

**Option B: Update to use standard PostgreSQL client**
- If `@vercel/postgres` doesn't work, we can switch to `pg` or `postgres` package
- This requires code changes (see below)

## Running the Migration

After setting up the database:

1. **Get Connection String**
   - Go to Neon dashboard (or your provider's dashboard)
   - Copy the connection string
   - It should look like: `postgresql://user:password@host/database`

2. **Run SQL Migration**
   - Option A: Use Neon's SQL Editor
     - Go to Neon dashboard â†’ SQL Editor
     - Copy and paste the SQL from `sql/init.sql`
     - Execute the query
   
   - Option B: Use Vercel CLI
     ```bash
     # Set the connection string locally
     export DATABASE_URL="your-neon-connection-string"
     
     # Or use a database client like psql
     psql "your-neon-connection-string" -f sql/init.sql
     ```

## Environment Variables

After setup, ensure these variables are in your Vercel project:

- `DATABASE_URL` or `POSTGRES_URL` (main connection string)
- Other variables may be auto-generated by the provider

## Testing

1. Deploy your app to Vercel
2. Go to the Submit Feedback page
3. Submit a test feedback
4. Check your database to verify it was saved

## Free Tier Comparison

- **Neon**: 0.5 GB storage, generous free tier
- **Supabase**: 500 MB storage, 2 GB bandwidth/month
- Both are excellent choices for this project

## Troubleshooting

### Connection Issues
- Verify the connection string format
- Check that environment variables are set in Vercel
- Ensure the database is in the same region as your Vercel deployment

### Migration Issues
- Make sure you're connected to the correct database
- Verify the SQL syntax is correct
- Check database permissions

## Next Steps

1. Choose a provider (Neon recommended)
2. Set up the database through Vercel Marketplace
3. Run the migration SQL
4. Test the feedback submission
5. Verify data is being saved

